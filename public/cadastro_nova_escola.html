<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="cadastro_nova_escola_css.css" />
    <title>Cadastro de Nova Escola</title>
  </head>
  <body>
    <h1>Cadastro de Nova Escola</h1>

    <form action="">
      <label>Nome:</label>
      <input type="text" />
      <label>CEP:</label>
      <input id="cep" type="text" placeholder="00.000-000" />
      <label>Bairro:</label>
      <input id="bairro" type="text" />
      <label>Endereço:</label>
      <input id="endereco" type="text" />
      <label>Telefone + DDD:</label>
      <input id="telefone" type="text" placeholder="(00) 00000-0000" />
      <label>Responsável</label>
      <input type="text" />
      <input type="submit" value="Adicionar" />
    </form>

    <script>
      const cepField = document.querySelector("#cep");
      const telefoneField = document.querySelector("#telefone");

      async function handleCep(cepNumber) {
        const cepRegex = /(\d{2})(\d{3})(\d{3})/i;
        const cepFormat = "$1.$2-$3";
        cepField.value = cepNumber.replace(cepRegex, cepFormat);

        const apiUrl = `https://viacep.com.br/ws/${cepNumber}/json/`;
        const response = await fetch(apiUrl);
        const data = await response.json();

        const { bairro, logradouro } = data;
        document.querySelector("#bairro").value = bairro;
        document.querySelector("#endereco").value = logradouro;
      }

      cepField.addEventListener("keyup", (evt) => {
        const cepNumber = evt.target.value;
        if (cepNumber.length == 8) handleCep(cepNumber);
      });

      telefoneField.addEventListener("keyup", (evt) => {
        const telNumber = evt.target.value;
        if (telNumber.length == 11) {
          const telRegex = /(\d{2})(\d{5})(\d{4})/;
          const telFormat = "($1) $2-$3";
          telefoneField.value = telNumber.replace(telRegex, telFormat);
        }
      });
    </script>
  </body>
</html>
